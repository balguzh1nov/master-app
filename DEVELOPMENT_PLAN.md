# План разработки функционала MVP

После завершения верстки всех экранов необходимо реализовать следующий функционал:

---

## 1. Инфраструктура и настройка проекта

### 1.1 База данных
- [ ] Выбрать БД (PostgreSQL)
- [ ] Настроить ORM (Prisma)
- [ ] Создать схему БД:
  - [ ] Таблица `users` (клиенты и специалисты)
  - [ ] Таблица `specialists` (расширенная информация о специалистах)
  - [ ] Таблица `requests` (заявки)
  - [ ] Таблица `chats` (чаты)
  - [ ] Таблица `messages` (сообщения)
  - [ ] Таблица `reviews` (отзывы)
  - [ ] Таблица `categories` (категории)
  - [ ] Таблица `specialist_categories` (связь специалист-категория)
  - [ ] Таблица `request_images` (фото заявок)
  - [ ] Таблица `review_images` (фото отзывов)
  - [ ] Таблица `portfolio_images` (фото портфолио)

### 1.2 Переменные окружения
- [ ] Создать `.env` с настройками:
  - [ ] DATABASE_URL
  - [ ] JWT_SECRET
  - [ ] EMAIL_SERVICE_API_KEY (для отправки кодов)
  - [ ] SMS_SERVICE_API_KEY (опционально)
  - [ ] FILE_UPLOAD_PATH или S3 credentials
  - [ ] NEXTAUTH_SECRET (если используем NextAuth)

### 1.3 Установка зависимостей
- [ ] Установить ORM (Prisma/Drizzle)
- [ ] Установить библиотеку для аутентификации (NextAuth.js/JWT)
- [ ] Установить библиотеку для валидации (Zod/Yup)
- [ ] Установить библиотеку для работы с файлами (multer/formidable)
- [ ] Установить библиотеку для real-time (Socket.io/Pusher)
- [ ] Установить библиотеку для отправки email (nodemailer/Resend)

---

## 2. Аутентификация и авторизация

### 2.1 Регистрация клиента
- [ ] API endpoint: `POST /api/auth/register-client`
- [ ] Валидация email
- [ ] Отправка кода подтверждения на email
- [ ] Сохранение данных регистрации (временное хранилище)
- [ ] Проверка кода подтверждения
- [ ] Создание аккаунта после подтверждения
- [ ] Генерация JWT токена
- [ ] Редирект на главную после регистрации

### 2.2 Регистрация специалиста
- [ ] API endpoint: `POST /api/auth/register-specialist`
- [ ] Валидация email/телефона
- [ ] Отправка кода подтверждения
- [ ] Сохранение многошаговой формы регистрации
- [ ] Проверка кода подтверждения
- [ ] Создание аккаунта специалиста
- [ ] Загрузка фото профиля
- [ ] Сохранение категорий работ
- [ ] Генерация JWT токена

### 2.3 Вход клиента
- [ ] API endpoint: `POST /api/auth/login-client`
- [ ] Валидация email
- [ ] Отправка кода на email
- [ ] API endpoint: `POST /api/auth/verify-code`
- [ ] Проверка кода
- [ ] Выдача JWT токена
- [ ] Сохранение сессии

### 2.4 Вход специалиста
- [ ] API endpoint: `POST /api/auth/login-specialist`
- [ ] Поддержка входа по email и телефону
- [ ] Отправка кода подтверждения
- [ ] Проверка кода
- [ ] Выдача JWT токена

### 2.5 Сброс пароля
- [ ] API endpoint: `POST /api/auth/reset-password`
- [ ] Отправка кода на email
- [ ] Проверка кода
- [ ] API endpoint: `POST /api/auth/set-new-password`
- [ ] Обновление пароля

### 2.6 Middleware для защиты routes
- [ ] Создать middleware для проверки JWT
- [ ] Защитить приватные страницы
- [ ] Редирект неавторизованных пользователей
- [ ] Проверка роли (клиент/специалист)

### 2.7 Управление сессией
- [ ] Хранение токена (cookies/localStorage)
- [ ] Обновление токена
- [ ] Выход из системы
- [ ] Проверка валидности токена на каждом запросе

---

## 3. Профили пользователей

### 3.1 Профиль специалиста (просмотр)
- [ ] API endpoint: `GET /api/specialists/[id]`
- [ ] Получение данных специалиста
- [ ] Получение портфолио
- [ ] Получение отзывов
- [ ] Расчет рейтинга
- [ ] Отображение категорий работ
- [ ] Отображение статистики (выполнено заказов)

### 3.2 Редактирование профиля специалиста
- [ ] API endpoint: `GET /api/specialists/me` (получение своего профиля)
- [ ] API endpoint: `PUT /api/specialists/me` (обновление профиля)
- [ ] Загрузка фото профиля
- [ ] Обновление описания
- [ ] Обновление категорий работ
- [ ] Обновление цен
- [ ] Обновление контактов
- [ ] Загрузка фото портфолио
- [ ] Удаление фото портфолио

### 3.3 Профиль клиента
- [ ] API endpoint: `GET /api/clients/me`
- [ ] API endpoint: `PUT /api/clients/me`
- [ ] Обновление данных клиента

---

## 4. Поиск и фильтрация

### 4.1 Поиск специалистов
- [ ] API endpoint: `GET /api/specialists/search`
- [ ] Фильтрация по городу
- [ ] Фильтрация по категории
- [ ] Фильтрация по подкатегории
- [ ] Фильтрация по рейтингу
- [ ] Фильтрация по цене (от/до)
- [ ] Сортировка (по рейтингу, цене, количеству отзывов)
- [ ] Пагинация результатов
- [ ] Поиск по названию/описанию (опционально)

### 4.2 Главная страница
- [ ] API endpoint: `GET /api/specialists/featured` (популярные специалисты)
- [ ] API endpoint: `GET /api/reviews/recent` (последние отзывы)
- [ ] Кэширование данных для главной страницы

### 4.3 Страница категории
- [ ] API endpoint: `GET /api/categories/[slug]`
- [ ] Получение специалистов по категории
- [ ] Фильтрация и сортировка

---

## 5. Заявки (Requests)

### 5.1 Создание заявки клиентом
- [ ] API endpoint: `POST /api/requests`
- [ ] Валидация данных формы
- [ ] Загрузка фото заявки (до 5 файлов)
- [ ] Сохранение заявки в БД
- [ ] Привязка к специалисту (если создается через профиль)
- [ ] Отправка уведомления специалисту
- [ ] Редирект на страницу заявки

### 5.2 Просмотр заявок клиента
- [ ] API endpoint: `GET /api/requests/my-requests`
- [ ] Получение всех заявок клиента
- [ ] Фильтрация по статусу
- [ ] Отображение связанного специалиста
- [ ] Отображение статуса заявки

### 5.3 Просмотр заявок для специалиста
- [ ] API endpoint: `GET /api/requests/available`
- [ ] Получение доступных заявок
- [ ] Фильтрация по категории специалиста
- [ ] Фильтрация по городу
- [ ] Исключение уже откликнувшихся заявок
- [ ] Сортировка по дате создания

### 5.4 Детали заявки
- [ ] API endpoint: `GET /api/requests/[id]`
- [ ] Получение полной информации о заявке
- [ ] Получение фото заявки
- [ ] Получение информации о клиенте
- [ ] Проверка прав доступа

### 5.5 Отклик специалиста на заявку
- [ ] API endpoint: `POST /api/requests/[id]/respond`
- [ ] Проверка, что специалист не откликался ранее
- [ ] Создание связи специалист-заявка
- [ ] Отправка уведомления клиенту
- [ ] Автоматическое создание чата

### 5.6 Статусы заявок
- [ ] Статусы: "Новая", "В работе", "Выполнена", "Отменена"
- [ ] API endpoint: `PUT /api/requests/[id]/status`
- [ ] Обновление статуса заявки
- [ ] Проверка прав на изменение статуса

---

## 6. Чат (Real-time messaging)

### 6.1 Создание чата
- [ ] Автоматическое создание при отклике на заявку
- [ ] API endpoint: `POST /api/chats`
- [ ] Связь чата с заявкой
- [ ] Участники чата (клиент + специалист)

### 6.2 Список чатов
- [ ] API endpoint: `GET /api/chats`
- [ ] Получение всех чатов пользователя
- [ ] Последнее сообщение в чате
- [ ] Количество непрочитанных сообщений
- [ ] Сортировка по дате последнего сообщения

### 6.3 Сообщения в чате
- [ ] API endpoint: `GET /api/chats/[id]/messages`
- [ ] Получение истории сообщений
- [ ] Пагинация сообщений
- [ ] Отметка сообщений как прочитанных

### 6.4 Отправка сообщений
- [ ] API endpoint: `POST /api/chats/[id]/messages`
- [ ] Валидация сообщения
- [ ] Сохранение сообщения в БД
- [ ] Real-time отправка через WebSocket/Socket.io
- [ ] Уведомление получателю
- [ ] Обновление списка чатов

### 6.5 Real-time обновления
- [ ] Настроить WebSocket сервер (Socket.io)
- [ ] Подключение клиента к WebSocket
- [ ] Отправка сообщений в реальном времени
- [ ] Получение новых сообщений без перезагрузки
- [ ] Индикатор "печатает..."
- [ ] Индикатор прочитано/доставлено

---

## 7. Отзывы (Reviews)

### 7.1 Создание отзыва клиентом о специалисте
- [ ] API endpoint: `POST /api/reviews`
- [ ] Проверка, что заявка выполнена
- [ ] Проверка, что отзыв еще не оставлен
- [ ] Валидация рейтинга (1-5)
- [ ] Загрузка фото отзыва (до 5 файлов)
- [ ] Сохранение отзыва в БД
- [ ] Пересчет рейтинга специалиста
- [ ] Уведомление специалисту

### 7.2 Создание отзыва специалистом о клиенте
- [ ] API endpoint: `POST /api/reviews/client`
- [ ] Аналогичная логика для отзывов о клиентах
- [ ] Сохранение в отдельную таблицу или поле

### 7.3 Просмотр отзывов
- [ ] API endpoint: `GET /api/reviews/specialist/[id]`
- [ ] Получение всех отзывов о специалисте
- [ ] Пагинация отзывов
- [ ] Фильтрация по рейтингу
- [ ] Сортировка по дате

### 7.4 Страница всех отзывов
- [ ] API endpoint: `GET /api/reviews/[id]` (детали отзыва)
- [ ] Отображение полной информации об отзыве

---

## 8. Загрузка файлов

### 8.1 Загрузка фото профиля
- [ ] API endpoint: `POST /api/upload/avatar`
- [ ] Валидация типа файла (только изображения)
- [ ] Валидация размера файла (макс 5MB)
- [ ] Ресайз изображения
- [ ] Сохранение на сервере или в S3
- [ ] Возврат URL изображения

### 8.2 Загрузка фото портфолио
- [ ] API endpoint: `POST /api/upload/portfolio`
- [ ] Множественная загрузка (до 10 файлов)
- [ ] Обработка каждого файла
- [ ] Сохранение в БД связь с профилем

### 8.3 Загрузка фото заявки
- [ ] API endpoint: `POST /api/upload/request`
- [ ] Загрузка до 5 файлов
- [ ] Привязка к заявке

### 8.4 Загрузка фото отзыва
- [ ] API endpoint: `POST /api/upload/review`
- [ ] Загрузка до 5 файлов
- [ ] Привязка к отзыву

### 8.5 Удаление файлов
- [ ] API endpoint: `DELETE /api/upload/[id]`
- [ ] Удаление файла с сервера
- [ ] Удаление записи из БД

---

## 9. Уведомления

### 9.1 Email уведомления
- [ ] Настроить email сервис (Resend/SendGrid)
- [ ] Шаблоны писем:
  - [ ] Код подтверждения регистрации
  - [ ] Код входа
  - [ ] Новая заявка для специалиста
  - [ ] Отклик на заявку для клиента
  - [ ] Новое сообщение в чате
  - [ ] Новый отзыв
- [ ] Отправка уведомлений через очередь (Bull/Agenda)

### 9.2 Push уведомления (опционально)
- [ ] Настроить Firebase Cloud Messaging или аналогичный сервис
- [ ] Регистрация устройств
- [ ] Отправка push уведомлений

### 9.3 In-app уведомления
- [ ] Таблица `notifications` в БД
- [ ] API endpoint: `GET /api/notifications`
- [ ] Отметка как прочитано
- [ ] Счетчик непрочитанных уведомлений

---

## 10. Настройки

### 10.1 Настройки уведомлений
- [ ] API endpoint: `GET /api/settings/notifications`
- [ ] API endpoint: `PUT /api/settings/notifications`
- [ ] Сохранение предпочтений пользователя
- [ ] Email/SMS/Push настройки

### 10.2 Безопасность
- [ ] Изменение пароля
- [ ] Удаление аккаунта
- [ ] API endpoint: `DELETE /api/users/me`

---

## 11. Валидация и обработка ошибок

### 11.1 Валидация форм
- [ ] Использовать Zod для валидации
- [ ] Схемы валидации для всех форм
- [ ] Отображение ошибок на фронтенде
- [ ] Валидация на бэкенде

### 11.2 Обработка ошибок
- [ ] Централизованный error handler
- [ ] Стандартизированные коды ошибок
- [ ] Логирование ошибок
- [ ] Пользовательские сообщения об ошибках

---

## 12. Оптимизация и производительность

### 12.2 Оптимизация изображений
- [ ] Использование Next.js Image компонента
- [ ] Ленивая загрузка изображений
- [ ] Оптимизация размера изображений

### 12.3 Пагинация
- [ ] Реализовать пагинацию везде, где нужно
- [ ] Infinite scroll для списков

### 12.4 SEO
- [ ] Meta теги для всех страниц
- [ ] Sitemap
- [ ] Robots.txt

---

## 13. Тестирование

### 13.1 Unit тесты
- [ ] Тесты для API endpoints
- [ ] Тесты для валидации
- [ ] Тесты для бизнес-логики

### 13.2 Integration тесты
- [ ] Тесты для полных user flows
- [ ] Тесты для аутентификации
- [ ] Тесты для чата

### 13.3 E2E тесты (опционально)
- [ ] Тесты критических путей пользователя

---

## 14. Деплой и инфраструктура

### 14.1 Подготовка к деплою
- [ ] Настроить production переменные окружения
- [ ] Настроить production БД
- [ ] Настроить CDN для статики и изображений
- [ ] Настроить мониторинг (Sentry/LogRocket)

### 14.2 CI/CD
- [ ] Настроить GitHub Actions или аналогичный
- [ ] Автоматические тесты при push
- [ ] Автоматический деплой

---

## Приоритеты разработки

### Фаза 1 (Критично - основа приложения):
1. База данных и ORM
2. Аутентификация (регистрация и вход)
3. Профили пользователей
4. Создание и просмотр заявок

### Фаза 2 (Важно - взаимодействие):
5. Чат (базовая версия без real-time)
6. Отзывы
7. Поиск и фильтрация

### Фаза 3 (Улучшения):
8. Real-time чат
9. Уведомления
10. Загрузка файлов
11. Оптимизация

---

## Технические рекомендации

### Backend API структура:
```
/api
  /auth
    /register-client
    /register-specialist
    /login-client
    /login-specialist
    /verify-code
    /reset-password
  /specialists
    /search
    /[id]
    /me
  /requests
    /my-requests
    /available
    /[id]
    /[id]/respond
  /chats
    /[id]/messages
  /reviews
    /specialist/[id]
  /upload
    /avatar
    /portfolio
    /request
    /review
  /settings
    /notifications
```

### Рекомендуемые библиотеки:
- **ORM**: Prisma (рекомендуется) или Drizzle
- **Валидация**: Zod
- **Аутентификация**: NextAuth.js или JWT
- **Файлы**: Multer или Formidable
- **Real-time**: Socket.io
- **Email**: Resend или Nodemailer
- **База данных**: PostgreSQL (рекомендуется)

---

## Оценка времени

- **Фаза 1**: 3-4 недели
- **Фаза 2**: 2-3 недели  
- **Фаза 3**: 2-3 недели

**Итого**: 7-10 недель для полного MVP функционала

